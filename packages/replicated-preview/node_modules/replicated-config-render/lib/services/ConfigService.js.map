{"version":3,"sources":["../../src/services/ConfigService.js"],"names":[],"mappings":"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","file":"ConfigService.js","sourcesContent":["var _ = require('lodash');\n\nvar ConfigService = {\n  getItems: function(groups) {\n    return _.without(_.flattenDeep(_.map(groups, function(group) {\n      return _.map(_.get(group, 'items', []), function(item) {\n        if (!_.isEmpty(item)) {\n          if (item.type === 'select_many') {\n            return _.map(_.get(item, 'items', []), function(childItem) {\n              if (!_.isEmpty(childItem)) {\n                return childItem;\n              }\n            });\n          }\n          return item;\n        }\n      });\n    })), null);\n  },\n\n  getItem: function getItem(groups, itemName) {\n    var item = null;\n    _.some(ConfigService.getItems(groups), function(otherItem) {\n      if (otherItem.name === itemName) {\n        item = otherItem;\n        return true;\n      }\n    });\n    return item;\n  },\n\n  evaluateWhen: function(groups, when) {\n    var checkWhen = function(obj, value, ne) {\n      var val = _.get(obj, 'value', null);\n      if (ne) {\n        return val && val.length > 0 ? val !== value : obj.default !== value;\n      }\n      return val && val.length > 0 ? val === value : obj.default === value;\n    };\n\n    if (when.length > 0) {\n      var whenParts = when.split('=', 2);\n      if (whenParts.length === 2) {\n        var opNe = false;\n        var itemName = whenParts[0];\n        var itemValue = whenParts[1];\n        if (itemName.substr(itemName.length - 1) === '!') {\n          opNe = true;\n          itemName = itemName.substr(0, itemName.length - 1);\n        }\n\n        var theItem = ConfigService.getItem(groups, itemName);\n        if (theItem !== null) {\n          var theItemWhen = _.get(theItem, 'when', '');\n          // recursively evaluate whens\n          if (theItemWhen.length > 0 && !ConfigService.evaluateWhen(groups, theItemWhen)) {\n            return false;\n          }\n          return checkWhen(theItem, itemValue, opNe);\n        }\n      }\n    }\n\n    return true;\n  },\n\n  isVisible: function(groups, obj) {\n    return !obj.hidden && ConfigService.isEnabled(groups, obj);\n  },\n\n  isEnabled: function(groups, obj) {\n    var when = _.get(obj, 'when', '');\n    return when.length > 0 ? ConfigService.evaluateWhen(groups, when) : true;\n  },\n};\n\nmodule.exports = ConfigService;\n"]}