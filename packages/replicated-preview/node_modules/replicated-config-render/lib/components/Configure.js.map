{"version":3,"sources":["../../src/components/Configure.js"],"names":[],"mappings":"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","file":"Configure.js","sourcesContent":["var _ = require('lodash');\nvar React = require('react');\n\nvar ConfigGroups = require('./ConfigGroups');\nvar ConfigService = require('../services/ConfigService');\n\nvar Configure = React.createClass({\n  getInitialState: function() {\n    return {\n      groups: this.props.groups,\n    };\n  },\n\n  componentDidMount: function() {\n    this.triggerChange(this.getData(this.props.groups));\n  },\n\n  componentWillReceiveProps: function(nextProps) {\n    this.setState({groups: nextProps.groups});\n  },\n\n  handleGroupsChange: function(groupName, itemName, value, data) {\n    var getValues = function(val) {\n      if (!val) {\n        return [];\n      }\n      return _.isArray(val) ? val : [val];\n    };\n    var getValue = function(val) {\n      if (!val) {\n        return val;\n      }\n      return _.isArray(val) ? _.first(val) : val;\n    };\n    var groups = _.map(this.props.groups, function(group) {\n      if (group.name === groupName) {\n        group.items = _.map(group.items, function(item) {\n          if (!(item.type in ['select_many', 'label', 'heading']) &&\n              item.name === itemName) {\n            if (item.multiple) {\n              item.multi_value = getValues(value);\n              if (item.type === 'file') {\n                item.multi_data = getValues(data);\n              }\n            } else {\n              item.value = getValue(value);\n              if (item.type === 'file') {\n                item.data = getValue(data);\n              }\n            }\n          } else {\n            if (item.type !== 'select_one') {\n              item.items = _.map(item.items, function(childItem) {\n                if (childItem.name === itemName) {\n                  if (childItem.multiple) {\n                    childItem.multi_value = getValues(value);\n                    if (childItem.type === 'file') {\n                      childItem.multi_data = getValues(data);\n                    }\n                  } else {\n                    childItem.value = getValue(value);\n                    if (childItem.type === 'file') {\n                      childItem.data = getValue(data);\n                    }\n                  }\n                }\n                return childItem;\n              });\n            }\n          }\n          return item;\n        });\n      }\n      return group;\n    });\n\n    this.setState({groups: groups});\n\n    // TODO: maybe this should only be on submit\n    this.triggerChange(this.getData(groups));\n  },\n\n  triggerChange: function(data) {\n    if (this.props.handleChange) {\n      this.props.handleChange(data);\n    }\n  },\n\n  getData: function(groups) {\n    var getItemData = function(item) {\n      var data = {\n        name: item.name,\n        value: '',\n        multi_value: [],\n      };\n      if (item.multiple) {\n        if (item.multi_value && item.multi_value.length) {\n          data.multi_value = item.multi_value;\n        } else if (item.default) {\n          data.multi_value = [item.default];\n        }\n      } else {\n        if (item.value && item.value.length) {\n          data.value = item.value;\n        } else {\n          data.value = item.default;\n        }\n      }\n      if (item.type === 'file') {\n        data.data = '';\n        if (item.multiple) {\n          if (item.multi_data && item.multi_data.length) {\n            data.multi_data = item.multi_data;\n          } else {\n            data.multi_data = [];\n          }\n        } else {\n          data.data = item.data;\n        }\n      }\n      return data;\n    };\n\n    var data = [];\n    _.each(groups, function(group) {\n      if (ConfigService.isEnabled(groups, group)) {\n        _.each(group.items, function(item) {\n          if (ConfigService.isEnabled(groups, item)) {\n            if (item.type !== 'select_many') {\n              data.push(getItemData(item));\n            }\n            if (item.type !== 'select_one') {\n              _.each(item.items, function(childItem) {\n                data.push(getItemData(childItem));\n              });\n            }\n          }\n        });\n      }\n    });\n\n    return data;\n  },\n\n  render: function() {\n    return (\n      <ConfigGroups\n        groups={this.state.groups}\n        handleChange={this.handleGroupsChange}\n        onTestProc={this.props.onTestProc} />\n    );\n  },\n});\n\nmodule.exports = Configure;\n"]}